{% extends "base.html" %}
{% block content %}
<h2>{{ thread.title }}</h2>
<p>{{ thread.content }}</p>
<small>Started by {{ thread.name }} on {{ thread.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
{% if thread.updated_at != thread.created_at %}
    <small>(Edited {{ thread.updated_at.strftime('%Y-%m-%d %H:%M:%S') }})</small>
{% endif %}
{% if session.get('loggedin') and session['id'] == thread.user_id %}
    <br>
    <a href="{{ url_for('edit_thread', thread_id=thread.id) }}">Edit Thread</a>
    <form method="POST" action="{{ url_for('delete_thread', thread_id=thread.id) }}" style="display:inline;">
        <button type="submit" onclick="return confirm('Are you sure you want to delete this thread?')">Delete Thread</button>
    </form>
{% endif %}
<hr>
<h3>Messages</h3>
{% for message in messages %}
    <div>
        <p>{{ message.content }}</p>
        <small>Posted by {{ message.name }} on {{ message.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
        {% if message.updated_at != message.created_at %}
            <small>(Edited {{ message.updated_at.strftime('%Y-%m-%d %H:%M:%S') }})</small>
        {% endif %}
        {% if session.get('loggedin') and session['id'] == message.user_id %}
            <br>
            <a href="{{ url_for('edit_message', message_id=message.id) }}">Edit</a>
            <form method="POST" action="{{ url_for('delete_message', message_id=message.id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this message?')">Delete</button>
            </form>
        {% endif %}
        <hr>
    </div>
{% else %}
    <p>No messages yet.</p>
{% endfor %}
{% if session.get('loggedin') %}
    <h3>Post a Message</h3>
    <form method="POST" action="{{ url_for('post_message', thread_id=thread.id) }}">
        <textarea name="content" rows="4" cols="60" required></textarea><br><br>
        <button type="submit">Post Message</button>
    </form>
{% else %}
    <p>You must <a href="{{ url_for('login') }}">log in</a> to post a message.</p>
{% endif %}
{% endblock %}
